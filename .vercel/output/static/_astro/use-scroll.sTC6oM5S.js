import{j as m}from"./jsx-runtime.B6N9iRLn.js";import{r as f}from"./index.DNi1g-pO.js";import{b as A,f as z,M as _,u as D,P as J,L as q,p as Q,v as Z,a as ee,h as te,c as ne,e as se,w as re,m as L}from"./VisualElement.CxbBZmL_.js";import{r as oe}from"./resolve-element.BwSRoGbS.js";function G(){const e=f.useRef(!1);return A(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function ie(){const e=G(),[t,s]=f.useState(0),n=f.useCallback(()=>{e.current&&s(t+1)},[t]);return[f.useCallback(()=>z.postRender(n),[n]),t]}class le extends f.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=s.offsetHeight||0,n.width=s.offsetWidth||0,n.top=s.offsetTop,n.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function ce({children:e,isPresent:t}){const s=f.useId(),n=f.useRef(null),r=f.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=f.useContext(_);return f.useInsertionEffect(()=>{const{width:c,height:l,top:a,left:u}=r.current;if(t||!n.current||!c||!l)return;n.current.dataset.motionPopId=s;const i=document.createElement("style");return o&&(i.nonce=o),document.head.appendChild(i),i.sheet&&i.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${l}px !important;
            top: ${a}px !important;
            left: ${u}px !important;
          }
        `),()=>{document.head.removeChild(i)}},[t]),m.jsx(le,{isPresent:t,childRef:n,sizeRef:r,children:f.cloneElement(e,{ref:n})})}const P=({children:e,initial:t,isPresent:s,onExitComplete:n,custom:r,presenceAffectsLayout:o,mode:c})=>{const l=D(fe),a=f.useId(),u=f.useMemo(()=>({id:a,initial:t,isPresent:s,custom:r,onExitComplete:i=>{l.set(i,!0);for(const d of l.values())if(!d)return;n&&n()},register:i=>(l.set(i,!1),()=>l.delete(i))}),o?[Math.random()]:[s]);return f.useMemo(()=>{l.forEach((i,d)=>l.set(d,!1))},[s]),f.useEffect(()=>{!s&&!l.size&&n&&n()},[s]),c==="popLayout"&&(e=m.jsx(ce,{isPresent:s,children:e})),m.jsx(J.Provider,{value:u,children:e})};function fe(){return new Map}function ue(e){return f.useEffect(()=>()=>e(),[])}const w=e=>e.key||"";function de(e,t){e.forEach(s=>{const n=w(s);t.set(n,s)})}function ae(e){const t=[];return f.Children.forEach(e,s=>{f.isValidElement(s)&&t.push(s)}),t}const Fe=({children:e,custom:t,initial:s=!0,onExitComplete:n,exitBeforeEnter:r,presenceAffectsLayout:o=!0,mode:c="sync"})=>{const l=f.useContext(q).forceRender||ie()[0],a=G(),u=ae(e);let i=u;const d=f.useRef(new Map).current,h=f.useRef(i),v=f.useRef(new Map).current,O=f.useRef(!0);if(A(()=>{O.current=!1,de(u,v),h.current=i}),ue(()=>{O.current=!0,v.clear(),d.clear()}),O.current)return m.jsx(m.Fragment,{children:i.map(p=>m.jsx(P,{isPresent:!0,initial:s?void 0:!1,presenceAffectsLayout:o,mode:c,children:p},w(p)))});i=[...i];const W=h.current.map(w),M=u.map(w),U=W.length;for(let p=0;p<U;p++){const g=W[p];M.indexOf(g)===-1&&!d.has(g)&&d.set(g,void 0)}return c==="wait"&&d.size&&(i=[]),d.forEach((p,g)=>{if(M.indexOf(g)!==-1)return;const B=v.get(g);if(!B)return;const X=W.indexOf(g);let R=p;if(!R){const Y=()=>{d.delete(g);const k=Array.from(v.keys()).filter(E=>!M.includes(E));if(k.forEach(E=>v.delete(E)),h.current=u.filter(E=>{const j=w(E);return j===g||k.includes(j)}),!d.size){if(a.current===!1)return;l(),n&&n()}};R=m.jsx(P,{isPresent:!1,onExitComplete:Y,custom:t,presenceAffectsLayout:o,mode:c,children:B},w(B)),d.set(g,R)}i.splice(X,0,R)}),i=i.map(p=>{const g=p.key;return d.has(g)?p:m.jsx(P,{isPresent:!0,presenceAffectsLayout:o,mode:c,children:p},w(p))}),m.jsx(m.Fragment,{children:d.size?i:i.map(p=>f.cloneElement(p))})},S=new WeakMap;let x;function he(e,t){if(t){const{inlineSize:s,blockSize:n}=t[0];return{width:s,height:n}}else return e instanceof SVGElement&&"getBBox"in e?e.getBBox():{width:e.offsetWidth,height:e.offsetHeight}}function pe({target:e,contentRect:t,borderBoxSize:s}){var n;(n=S.get(e))===null||n===void 0||n.forEach(r=>{r({target:e,contentSize:t,get size(){return he(e,s)}})})}function ge(e){e.forEach(pe)}function me(){typeof ResizeObserver>"u"||(x=new ResizeObserver(ge))}function ve(e,t){x||me();const s=oe(e);return s.forEach(n=>{let r=S.get(n);r||(r=new Set,S.set(n,r)),r.add(t),x?.observe(n)}),()=>{s.forEach(n=>{const r=S.get(n);r?.delete(t),r?.size||x?.unobserve(n)})}}const H=new Set;let C;function xe(){C=()=>{const e={width:window.innerWidth,height:window.innerHeight},t={target:window,size:e,contentSize:e};H.forEach(s=>s(t))},window.addEventListener("resize",C)}function we(e){return H.add(e),C||xe(),()=>{H.delete(e),!H.size&&C&&(C=void 0)}}function Ee(e,t){return typeof e=="function"?we(e):ve(e,t)}const ye=50,T=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),ze=()=>({time:0,x:T(),y:T()}),Ce={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function $(e,t,s,n){const r=s[t],{length:o,position:c}=Ce[t],l=r.current,a=s.time;r.current=e[`scroll${c}`],r.scrollLength=e[`scroll${o}`]-e[`client${o}`],r.offset.length=0,r.offset[0]=0,r.offset[1]=r.scrollLength,r.progress=Q(0,r.scrollLength,r.current);const u=n-a;r.velocity=u>ye?0:Z(r.current-l,u)}function Re(e,t,s){$(e,"x",t,s),$(e,"y",t,s),t.time=s}function Le(e,t){const s={x:0,y:0};let n=e;for(;n&&n!==t;)if(n instanceof HTMLElement)s.x+=n.offsetLeft,s.y+=n.offsetTop,n=n.offsetParent;else if(n.tagName==="svg"){const r=n.getBoundingClientRect();n=n.parentElement;const o=n.getBoundingClientRect();s.x+=r.left-o.left,s.y+=r.top-o.top}else if(n instanceof SVGGraphicsElement){const{x:r,y:o}=n.getBBox();s.x+=r,s.y+=o;let c=null,l=n.parentNode;for(;!c;)l.tagName==="svg"&&(c=l),l=n.parentNode;n=c}else break;return s}const Se={Enter:[[0,1],[1,1]],Exit:[[0,0],[1,0]],Any:[[1,0],[0,1]],All:[[0,0],[1,1]]},I={start:0,center:.5,end:1};function F(e,t,s=0){let n=0;if(e in I&&(e=I[e]),typeof e=="string"){const r=parseFloat(e);e.endsWith("px")?n=r:e.endsWith("%")?e=r/100:e.endsWith("vw")?n=r/100*document.documentElement.clientWidth:e.endsWith("vh")?n=r/100*document.documentElement.clientHeight:e=r}return typeof e=="number"&&(n=t*e),s+n}const He=[0,0];function Oe(e,t,s,n){let r=Array.isArray(e)?e:He,o=0,c=0;return typeof e=="number"?r=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?r=e.split(" "):r=[e,I[e]?e:"0"]),o=F(r[0],s,n),c=F(r[1],t),o-c}const We={x:0,y:0};function Me(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function Be(e,t,s){const{offset:n=Se.All}=s,{target:r=e,axis:o="y"}=s,c=o==="y"?"height":"width",l=r!==e?Le(r,e):We,a=r===e?{width:e.scrollWidth,height:e.scrollHeight}:Me(r),u={width:e.clientWidth,height:e.clientHeight};t[o].offset.length=0;let i=!t[o].interpolate;const d=n.length;for(let h=0;h<d;h++){const v=Oe(n[h],u[c],a[c],l[o]);!i&&v!==t[o].interpolatorOffsets[h]&&(i=!0),t[o].offset[h]=v}i&&(t[o].interpolate=ee(t[o].offset,te(n)),t[o].interpolatorOffsets=[...t[o].offset]),t[o].progress=t[o].interpolate(t[o].current)}function Pe(e,t=e,s){if(s.x.targetOffset=0,s.y.targetOffset=0,t!==e){let n=t;for(;n&&n!==e;)s.x.targetOffset+=n.offsetLeft,s.y.targetOffset+=n.offsetTop,n=n.offsetParent}s.x.targetLength=t===e?t.scrollWidth:t.clientWidth,s.y.targetLength=t===e?t.scrollHeight:t.clientHeight,s.x.containerLength=e.clientWidth,s.y.containerLength=e.clientHeight}function be(e,t,s,n={}){return{measure:()=>Pe(e,n.target,s),update:r=>{Re(e,s,r),(n.offset||n.target)&&Be(e,s,n)},notify:()=>t(s)}}const y=new WeakMap,N=new WeakMap,b=new WeakMap,K=e=>e===document.documentElement?window:e;function Ie(e,{container:t=document.documentElement,...s}={}){let n=b.get(t);n||(n=new Set,b.set(t,n));const r=ze(),o=be(t,e,r,s);if(n.add(o),!y.has(t)){const l=()=>{for(const h of n)h.measure()},a=()=>{for(const h of n)h.update(se.timestamp)},u=()=>{for(const h of n)h.notify()},i=()=>{z.read(l,!1,!0),z.read(a,!1,!0),z.update(u,!1,!0)};y.set(t,i);const d=K(t);window.addEventListener("resize",i,{passive:!0}),t!==document.documentElement&&N.set(t,Ee(t,i)),d.addEventListener("scroll",i,{passive:!0})}const c=y.get(t);return z.read(c,!1,!0),()=>{var l;ne(c);const a=b.get(t);if(!a||(a.delete(o),a.size))return;const u=y.get(t);y.delete(t),u&&(K(t).removeEventListener("scroll",u),(l=N.get(t))===null||l===void 0||l(),window.removeEventListener("resize",u))}}function V(e,t){re(!!(!t||t.current))}const Ae=()=>({scrollX:L(0),scrollY:L(0),scrollXProgress:L(0),scrollYProgress:L(0)});function Ne({container:e,target:t,layoutEffect:s=!0,...n}={}){const r=D(Ae);return(s?A:f.useEffect)(()=>(V("target",t),V("container",e),Ie(({x:c,y:l})=>{r.scrollX.set(c.current),r.scrollXProgress.set(c.progress),r.scrollY.set(l.current),r.scrollYProgress.set(l.progress)},{...n,container:e?.current||void 0,target:t?.current||void 0})),[e,t,JSON.stringify(n.offset)]),r}export{Fe as A,Ne as u};
